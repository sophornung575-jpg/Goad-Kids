<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Goat Kids Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:system-ui;background:#f5f6f8;margin:0}
header{background:#fff;padding:12px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
.container{max-width:1200px;margin:auto;padding:15px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px}
.card{background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 4px 10px rgba(0,0,0,.08)}
.card img{width:100%;height:200px;object-fit:cover}
.card-body{padding:12px}
.btn{padding:10px;border:none;border-radius:6px;width:100%;cursor:pointer}
.btn-orange{background:#ff6b35;color:#fff}
.btn-blue{background:#4a90e2;color:#fff}
.hidden{display:none}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center}
.modal.active{display:flex}
.modal-content{background:#fff;padding:20px;border-radius:10px;width:100%;max-width:420px}
</style>
</head>

<body>

<header>
<div class="container" style="display:flex;justify-content:space-between">
<b>ðŸ›’ Goat Kids Store</b>
<div>
<button onclick="openCart()">Cart (<span id="cartCount">0</span>)</button>
<button id="adminBtn" onclick="openAdmin()" class="hidden">Admin</button>
</div>
</div>
</header>

<div class="container">
<section id="store">
<div class="grid" id="productGrid"></div>
</section>

<section id="admin" class="hidden">
<h2>Admin</h2>
<input id="name" placeholder="Product name"><br><br>
<input id="price" type="number" placeholder="Price"><br><br>
<input id="stock" type="number" placeholder="Stock"><br><br>
<input id="size" placeholder="S,M,L"><br><br>
<input type="file" id="image"><br><br>
<button onclick="saveProduct()" class="btn btn-orange">Save</button>
<button onclick="logout()" class="btn btn-blue">Logout</button>
</section>
</div>

<div class="modal" id="cartModal">
<div class="modal-content">
<h3>Cart</h3>
<div id="cartItems"></div>
<h4 id="cartTotal"></h4>
<input id="cname" placeholder="Name">
<input id="cphone" placeholder="Phone">
<input id="caddr" placeholder="Address">
<button onclick="sendOrder()" class="btn btn-orange">Order via Messenger</button>
<button onclick="closeCart()" class="btn">Close</button>
</div>
</div>

<script>
const productGrid = document.getElementById("productGrid");
const cartCount = document.getElementById("cartCount");
const adminBtn = document.getElementById("adminBtn");

let products = JSON.parse(localStorage.getItem("products")||"[]");
let cart = JSON.parse(localStorage.getItem("cart")||"[]");
let isAdmin = localStorage.getItem("admin")==="1";

function save(){
localStorage.setItem("products",JSON.stringify(products));
localStorage.setItem("cart",JSON.stringify(cart));
}

function render(){
productGrid.innerHTML="";
products.forEach(p=>{
productGrid.innerHTML+=`
<div class="card">
<img src="${p.image}">
<div class="card-body">
<b>${p.name}</b><br>
$${p.price}<br>
Stock: ${p.stock}<br>
<select id="size-${p.id}">
<option value="">Size</option>
${p.sizes.map(s=>`<option>${s}</option>`).join("")}
</select>
<button class="btn btn-orange" onclick="addToCart(${p.id})">Add</button>
</div>
</div>`;
});
cartCount.textContent=cart.reduce((s,i)=>s+i.qty,0);
}

function saveProduct(){
const reader=new FileReader();
reader.onload=()=>{
products.push({
id:Date.now(),
name:name.value,
price:+price.value,
stock:+stock.value,
sizes:size.value.split(","),
image:reader.result
});
save();
render();
};
reader.readAsDataURL(image.files[0]);
}

function addToCart(id){
const p=products.find(x=>x.id===id);
const s=document.getElementById(`size-${id}`).value;
if(!s)return alert("Select size");

const item=cart.find(i=>i.id===id&&i.size===s);
if(item){
if(item.qty>=p.stock)return alert("No stock");
item.qty++;
}else{
cart.push({id,name:p.name,price:p.price,size:s,qty:1});
}
save();
render();
}

function openCart(){
renderCart();
document.getElementById("cartModal").classList.add("active");
}
function closeCart(){
document.getElementById("cartModal").classList.remove("active");
}

function renderCart(){
let t=0;
cartItems.innerHTML="";
cart.forEach(i=>{
t+=i.price*i.qty;
cartItems.innerHTML+=`${i.name} ${i.size} x${i.qty}<br>`;
});
cartTotal.textContent="Total: $"+t.toFixed(2);
}

function sendOrder(){
if(!cart.length)return alert("Cart empty");

/* REDUCE STOCK HERE ONLY */
cart.forEach(i=>{
const p=products.find(x=>x.id===i.id);
p.stock-=i.qty;
});

save();
cart=[];
localStorage.removeItem("cart");
render();
closeCart();
window.open("https://m.me/Goatkids","_blank");
}

function openAdmin(){
const pass=prompt("Password");
if(pass==="admin123"){
isAdmin=true;
localStorage.setItem("admin","1");
adminBtn.classList.remove("hidden");
store.classList.add("hidden");
admin.classList.remove("hidden");
}
}

function logout(){
localStorage.removeItem("admin");
location.reload();
}

if(isAdmin) adminBtn.classList.remove("hidden");
render();
</script>
</body>
</html>
