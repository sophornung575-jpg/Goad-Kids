<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Goat Kids Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;font-family:Segoe UI,system-ui;margin:0;padding:0}
body{background:#f5f6f8;padding-bottom:50px}
header{background:#fff;padding:15px;box-shadow:0 2px 8px rgba(0,0,0,.1);display:flex;justify-content:space-between;align-items:center}
header h1{margin:0;font-size:1.5em}
button{cursor:pointer;border:none;padding:6px 12px;border-radius:5px}
button:disabled{opacity:0.6;cursor:not-allowed}
.container{max-width:1200px;margin:20px auto;padding:0 10px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px}
.card{background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.1)}
.card img{width:100%;height:200px;object-fit:cover}
.card-body{padding:10px}
.price{color:#f60;font-weight:bold;margin:5px 0}
.size-tag{display:inline-block;background:#eee;padding:2px 5px;margin-right:5px;border-radius:3px;font-size:0.8em}
.cart-count{background:red;color:#fff;padding:2px 6px;border-radius:50%;margin-left:5px;font-size:0.8em}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:1000}
.modal-content{background:#fff;padding:20px;border-radius:10px;max-width:500px;width:90%;position:relative}
.modal-content h2{margin-bottom:10px}
.close-btn{position:absolute;top:10px;right:10px;background:#f00;color:#fff;font-weight:bold;border-radius:50%;width:25px;height:25px;line-height:25px;text-align:center}
.alert-error{color:red}
.alert-success{color:green}
.hidden{display:none}
.edit-btn{margin-right:5px;padding:4px 8px}
.btn-red{background:#f44336;color:#fff}
.btn-orange{background:orange;color:#fff}
.cart-item{display:flex;justify-content:space-between;margin-bottom:5px}
</style>
</head>
<body>

<header>
  <h1>Goat Kids Store</h1>
  <div>
    <button id="cartBtn">Cart <span id="cartCount" class="cart-count">0</span></button>
    <button id="adminBtn" style="display:none;">Admin</button>
  </div>
</header>

<div id="store" class="container">
  <div id="productGrid" class="grid"></div>
</div>

<!-- Admin Panel -->
<div id="admin" class="container hidden">
  <h2>Admin Panel</h2>
  <div>
    <input type="text" id="name" placeholder="Product Name">
    <input type="number" id="price" placeholder="Price">
    <input type="number" id="stock" placeholder="Stock">
    <input type="text" id="size" placeholder="Sizes (comma separated)">
    <input type="file" id="image">
    <img id="preview" class="hidden" width="100" height="100">
    <button id="saveBtn">Save Product</button>
    <button id="cancelEditBtn" class="hidden">Cancel Edit</button>
  </div>
  <h3>Existing Products</h3>
  <div id="editProductsDiv"></div>
  <button onclick="logout()">Logout</button>
</div>

<!-- Cart Modal -->
<div id="cartModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeCart()">Ã—</span>
    <h2>Your Cart</h2>
    <div id="cartItems"></div>
    <p id="cartTotal"></p>
    <input type="text" id="cname" placeholder="Your Name"><br>
    <input type="text" id="cphone" placeholder="Phone"><br>
    <input type="text" id="caddr" placeholder="Address"><br>
    <button onclick="sendOrder()">Send Order via Messenger</button>
  </div>
</div>

<script>
let products = JSON.parse(localStorage.getItem("products"))||[];
let cart = JSON.parse(localStorage.getItem("cart"))||[];
let currentEditId = null;
let currentImageData = null;
let adminUnlocked = localStorage.getItem("admin") === "true";

// DOM
const productGrid = document.getElementById("productGrid");
const cartCount = document.getElementById("cartCount");
const cartModal = document.getElementById("cartModal");
const store = document.getElementById("store");
const admin = document.getElementById("admin");
const adminBtn = document.getElementById("adminBtn");
const editProductsDiv = document.getElementById("editProductsDiv");
const preview = document.getElementById("preview");
const imageInput = document.getElementById("image");
const saveBtn = document.getElementById("saveBtn");
const cancelEditBtn = document.getElementById("cancelEditBtn");
const PAGE_NAME = "Goat Kids Store";

// Image preview
imageInput.addEventListener("change",()=>{
    const file = imageInput.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = e=>{preview.src=e.target.result;preview.classList.remove("hidden");currentImageData=e.target.result;}
        reader.readAsDataURL(file);
    }
});

// Cart buttons
document.getElementById("cartBtn").addEventListener("click",openCart);

// Admin button
adminBtn.addEventListener("click",()=>{
    store.classList.toggle("hidden");
    admin.classList.toggle("hidden");
});

// Save product
saveBtn.addEventListener("click",()=>{
    const name = document.getElementById("name").value.trim();
    const price = parseFloat(document.getElementById("price").value);
    const stock = parseInt(document.getElementById("stock").value);
    const sizes = document.getElementById("size").value.split(",").map(s=>s.trim()).filter(s=>s);
    if(!name||isNaN(price)||isNaN(stock)||!currentImageData){alert("Fill all fields & select image.");return;}
    if(currentEditId!==null){
        const index = products.findIndex(p=>p.id===currentEditId);
        products[index] = { ...products[index], name, price, stock, sizes, image: currentImageData };
        currentEditId=null;
        cancelEditBtn.classList.add("hidden");
    }else{
        const id = Date.now();
        products.push({id,name,price,stock,sizes,image:currentImageData});
    }
    localStorage.setItem("products",JSON.stringify(products));
    renderProducts();
    renderAdminEdit();
    resetAdminForm();
});

// Cancel edit
cancelEditBtn.addEventListener("click",()=>{
    currentEditId=null;
    resetAdminForm();
    cancelEditBtn.classList.add("hidden");
});

// Reset admin form
function resetAdminForm(){
    document.getElementById("name").value="";
    document.getElementById("price").value="";
    document.getElementById("stock").value="";
    document.getElementById("size").value="";
    imageInput.value="";
    preview.classList.add("hidden");
    currentImageData=null;
}

// Render products
function renderProducts(){
    productGrid.innerHTML="";
    products.forEach(product=>{
        const card=document.createElement("div");
        card.className="card";
        card.innerHTML=`
            <img src="${product.image}" alt="${product.name}">
            <div class="card-body">
                <h4>${product.name}</h4>
                <p class="price">$${product.price.toFixed(2)}</p>
                <div class="product-sizes">${product.sizes.map(s=>`<span class="size-tag">${s}</span>`).join("")}</div>
                <p>Stock: ${product.stock}</p>
                <button class="btn btn-orange" onclick="addToCart(${product.id})" ${product.stock<=0?"disabled":""}>Add to Cart</button>
            </div>
        `;
        productGrid.appendChild(card);
    });
}

// Render admin product list
function renderAdminEdit(){
    editProductsDiv.innerHTML="";
    products.forEach(p=>{
        const div=document.createElement("div");
        div.className="order";
        div.innerHTML=`
            <h4>${p.name}</h4>
            <p>Price: $${p.price.toFixed(2)} | Stock: ${p.stock}</p>
            <button class="edit-btn" onclick="editProduct(${p.id})">Edit</button>
            <button class="edit-btn btn-red" onclick="deleteProduct(${p.id})">Delete</button>
        `;
        editProductsDiv.appendChild(div);
    });
}

// Edit / Delete product
function editProduct(id){
    const product = products.find(p=>p.id===id);
    if(!product) return;
    document.getElementById("name").value = product.name;
    document.getElementById("price").value = product.price;
    document.getElementById("stock").value = product.stock;
    document.getElementById("size").value = product.sizes.join(",");
    preview.src = product.image; preview.classList.remove("hidden"); currentImageData=product.image;
    currentEditId=id;
    cancelEditBtn.classList.remove("hidden");
}

function deleteProduct(id){
    if(confirm("Delete this product?")){
        products = products.filter(p=>p.id!==id);
        localStorage.setItem("products",JSON.stringify(products));
        renderProducts(); renderAdminEdit();
    }
}

// Cart
function addToCart(id){
    const product = products.find(p=>p.id===id);
    if(!product||product.stock<=0)return;
    const cartItem = cart.find(c=>c.id===id);
    if(cartItem){
        if(cartItem.qty<product.stock) cartItem.qty++;
        else alert("Not enough stock!");
    }else{
        cart.push({id:product.id,name:product.name,price:product.price,qty:1});
    }
    localStorage.setItem("cart",JSON.stringify(cart));
    updateCartCount();
}

function updateCartCount(){
    cartCount.textContent = cart.reduce((a,b)=>a+b.qty,0);
}

function openCart(){
    cartModal.style.display="flex"; renderCartItems();
}
function closeCart(){cartModal.style.display="none";}

function renderCartItems(){
    const container=document.getElementById("cartItems");
    const totalEl=document.getElementById("cartTotal");
    container.innerHTML="";
    let total=0;
    if(cart.length===0) container.innerHTML="<p>Cart is empty.</p>";
    cart.forEach(item=>{
        const div=document.createElement("div");
        div.className="cart-item";
        div.innerHTML=`<span>${item.name} x ${item.qty}</span><span>$${(item.price*item.qty).toFixed(2)}</span>`;
        container.appendChild(div);
        total+=item.price*item.qty;
    });
    totalEl.textContent=`Total: $${total.toFixed(2)}`;
}

// Send order via Messenger
function sendOrder(){
    const cname=document.getElementById("cname").value.trim();
    const cphone=document.getElementById("cphone").value.trim();
    const caddr=document.getElementById("caddr").value.trim();
    if(!cname||!cphone||!caddr||cart.length===0){alert("Fill customer info & cart.");return;}
    let message=`Hello, I want to order from ${PAGE_NAME}:\n`;
    cart.forEach(item=>{
        message+=`${item.name} x ${item.qty} = $${(item.price*item.qty).toFixed(2)}\n`;
        const p = products.find(pr=>pr.id===item.id); if(p)p.stock-=item.qty;
    });
    message+=`\nName: ${cname}\nPhone: ${cphone}\nAddress: ${caddr}`;
    localStorage.setItem("products",JSON.stringify(products));
    cart=[]; localStorage.setItem("cart",JSON.stringify(cart));
    updateCartCount(); renderProducts(); renderAdminEdit(); closeCart();
    const encoded = encodeURIComponent(message);
    window.open(`https://m.me/Goatkids?ref=${encoded}`,"_blank");
}

// Init
document.addEventListener("DOMContentLoaded",()=>{
    updateCartCount();
    renderProducts();
    if(adminUnlocked) adminBtn.style.display="inline-block";
});
</script>

</body>
</html>
