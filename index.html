<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Goat Kids Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:system-ui;background:#f5f6f8}
header{background:#fff;padding:15px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.container{max-width:1200px;margin:auto}
button{padding:8px 14px;border:none;border-radius:6px;cursor:pointer}
.btn-blue{background:#007bff;color:#fff}
.btn-gray{background:#ddd}
.hidden{display:none}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px}
.card{background:#fff;padding:10px;border-radius:8px}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center}
.modal-content{background:#fff;padding:20px;border-radius:8px;width:300px}
input{width:100%;padding:8px;margin:6px 0}
.dashboard{display:flex;gap:20px;margin-bottom:20px}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>

<header>
  <div class="container" style="display:flex;justify-content:space-between">
    <b>ðŸ›’ Goat Kids Store</b>
    <div>
      <button onclick="openCart()">Cart (<span id="cartCount">0</span>)</button>
      <button id="adminBtn" onclick="openAdmin()">Admin</button>
    </div>
  </div>
</header>

<div class="container">

<!-- STORE -->
<div id="store">
  <h2>Products</h2>
  <div class="grid" id="productGrid"></div>
</div>

<!-- ADMIN -->
<div id="admin" class="hidden">
  <h2>Admin Dashboard</h2>

  <div class="dashboard">
    <div>Total Orders: <b id="totalOrders">0</b></div>
    <div>Revenue: <b id="revenue">$0</b></div>
  </div>

  <h3>Add Product</h3>
  <input id="pName" placeholder="Name">
  <input id="pPrice" type="number" placeholder="Price">
  <input id="pStock" type="number" placeholder="Stock">
  <input id="pImage" placeholder="Image URL">
  <button class="btn-blue" onclick="addProduct()">Add</button>

  <h3>Orders</h3>
  <div id="orderList"></div>
</div>

</div>

<!-- LOGIN MODAL -->
<div class="modal" id="loginModal">
  <div class="modal-content">
    <h3>Admin Login</h3>
    <input id="loginEmail" type="email" placeholder="Email">
    <input id="loginPassword" type="password" placeholder="Password">
    <button class="btn-blue" onclick="adminLogin()">Login</button>
    <button class="btn-gray" onclick="closeModal()">Cancel</button>
  </div>
</div>

<!-- CART MODAL -->
<div class="modal" id="cartModal">
  <div class="modal-content">
    <h3>Checkout</h3>
    <div id="cartItems"></div>
    <b>Total: $<span id="cartTotal">0</span></b>

    <input id="cName" placeholder="Name">
    <input id="cPhone" placeholder="Phone">
    <input id="cAddress" placeholder="Address">

    <img id="khqrImg" style="width:220px;margin:10px 0">

    <button class="btn-blue" onclick="placeOrder()">Place Order</button>
    <button class="btn-gray" onclick="closeCart()">Close</button>
  </div>
</div>

<script>
// ðŸ”¥ FIREBASE CONFIG (REPLACE)
firebase.initializeApp({
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID"
});

const auth = firebase.auth();
const db = firebase.firestore();

// STATE
let cart = [];
let products = [];

// ---------------- STORE ----------------
db.collection("products").onSnapshot(snap=>{
  products = [];
  productGrid.innerHTML = "";
  snap.forEach(doc=>{
    const p = {id:doc.id,...doc.data()};
    products.push(p);
    productGrid.innerHTML += `
      <div class="card">
        <img src="${p.image}" style="width:100%">
        <b>${p.name}</b>
        <p>$${p.price}</p>
        <button onclick="addToCart('${p.id}')">Add</button>
      </div>`;
  });
});

function addToCart(id){
  const p = products.find(x=>x.id===id);
  cart.push({...p,qty:1});
  cartCount.textContent = cart.length;
}

// ---------------- CART ----------------
function openCart(){
  cartModal.style.display="flex";
  renderCart();
}
function closeCart(){ cartModal.style.display="none"; }

function renderCart(){
  cartItems.innerHTML="";
  let total=0;
  cart.forEach(i=>{
    total+=i.price*i.qty;
    cartItems.innerHTML+=`<div>${i.name} - $${i.price}</div>`;
  });
  cartTotal.textContent=total.toFixed(2);
}

function generateKHQR(amount, orderId){
  return `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=ABA|${orderId}|${amount}`;
}

// ---------------- ORDER ----------------
function placeOrder(){
  const order = {
    customerName:cName.value,
    phone:cPhone.value,
    address:cAddress.value,
    items:cart,
    total:parseFloat(cartTotal.textContent),
    status:"pending",
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  };

  db.collection("orders").add(order).then(ref=>{
    khqrImg.src = generateKHQR(order.total, ref.id);
    cart=[];
    cartCount.textContent=0;
  });
}

// ---------------- ADMIN ----------------
function openAdmin(){ loginModal.style.display="flex"; }
function closeModal(){ loginModal.style.display="none"; }

function adminLogin(){
  auth.signInWithEmailAndPassword(loginEmail.value, loginPassword.value)
    .then(u=>checkAdmin(u.user.uid))
    .catch(e=>alert(e.message));
}

function checkAdmin(uid){
  db.collection("admins").doc(uid).get().then(doc=>{
    if(doc.exists){
      loginModal.style.display="none";
      store.classList.add("hidden");
      admin.classList.remove("hidden");
      loadOrders();
    } else {
      alert("Not admin");
      auth.signOut();
    }
  });
}

function addProduct(){
  db.collection("products").add({
    name:pName.value,
    price:+pPrice.value,
    stock:+pStock.value,
    image:pImage.value
  });
}

// ---------------- ORDERS ----------------
function loadOrders(){
  db.collection("orders").onSnapshot(snap=>{
    orderList.innerHTML="";
    let totalOrders=0,revenue=0;

    snap.forEach(doc=>{
      const o=doc.data(); totalOrders++;
      if(o.status==="paid") revenue+=o.total;

      orderList.innerHTML+=`
        <div class="card">
          <b>${o.customerName}</b> - ${o.status}
          <button onclick="updateOrder('${doc.id}','paid')">Paid</button>
          <button onclick="updateOrder('${doc.id}','shipped')">Shipped</button>
        </div>`;
    });

    totalOrdersEl.textContent=totalOrders;
    revenueEl.textContent="$"+revenue.toFixed(2);
  });
}

function updateOrder(id,status){
  db.collection("orders").doc(id).update({status});
}
</script>

</body>
</html>
